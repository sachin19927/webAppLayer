<p appHighlightDirective>Library {{libraryStatus | async}}</p>

<input type="text" [(ngModel)]="filterByKeyValue"/>
<br>
<button (click)="addBooks()">Add Book</button>

<!-- <div *ngFor="let book of books | dataFilter:filterByKeyValue:'author' ">
    <a [routerLink]="['/library/view',book.id]"
    [queryParams]="{'allwedTo':true}"
    fragment="loading"
    >View</a>
</div> -->

<mat-table [dataSource]="books | dataFilter:filterByKeyValue:'author'" >
 <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
   <mat-header-cell *matHeaderCellDef> {{column}} </mat-header-cell>
 </ng-container>

 <ng-container matColumnDef="{{key}}" *ngFor="let key of KeyToDisplay">

    <ng-container *ngIf="key==='id'">
      <mat-cell  *matCellDef="let element"> {{element[key] }} </mat-cell>
    </ng-container>

    <ng-container *ngIf="key==='name' ||  key==='author' ">
      <mat-cell  *matCellDef="let element"> {{element[key] | wordShortner:12 |uppercase}} </mat-cell>
    </ng-container>

    <ng-container *ngIf="key==='year'">
      <mat-cell  *matCellDef="let element"> {{element[key]}} </mat-cell>
    </ng-container>

    <ng-container *ngIf="key==='price'">
      <mat-cell  *matCellDef="let element"> {{element[key] | currency:'USD' }} </mat-cell>
    </ng-container>

    <ng-container *ngIf="key==='category'">
      <mat-cell  *matCellDef="let element"> {{element[key] }} </mat-cell>
    </ng-container>

    <ng-container *ngIf="key==='publishedDate'">
      <mat-cell  *matCellDef="let element"> {{element[key] | date:'fullDate' }} </mat-cell>
    </ng-container>

  <ng-container *ngIf="key==='action'">
      <mat-cell  *matCellDef="let element">
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="loadBookToEdit(element['id'])">
            <mat-icon>dialpad</mat-icon>
            <span>Edit</span>
          </button>
          <button mat-menu-item (click)="loadBookToEdit(element['id'])">
            <mat-icon>voicemail</mat-icon>
            <span>View</span>
          </button>
        </mat-menu>
      </mat-cell>
    </ng-container>
 </ng-container>

 <mat-header-row appHighlightBetter [defaultColor]="'yellow'" [highLight]="'red'"   *matHeaderRowDef="columnsToDisplay"></mat-header-row>
 <mat-row *matRowDef="let element; columns: KeyToDisplay;"></mat-row>
</mat-table>
